#!/usr/bin/make -f

%:
	dh $@

override_dh_auto_build:
	# 不需要构建，只是打包应用文件

override_dh_auto_install:
	# 创建目录
	mkdir -p debian/oopz-electron/usr/lib/oopz-electron
	mkdir -p debian/oopz-electron/usr/bin
	mkdir -p debian/oopz-electron/usr/share/applications
	mkdir -p debian/oopz-electron/usr/share/icons/hicolor/256x256/apps
	
	# 复制应用文件
	cp main.js package.json debian/oopz-electron/usr/lib/oopz-electron/
	cp icon.png debian/oopz-electron/usr/share/icons/hicolor/256x256/apps/oopz-electron.png
	
	# 创建启动脚本
	echo '#!/bin/sh' > debian/oopz-electron/usr/bin/oopz-electron
	echo 'APP_DIR="/usr/lib/oopz-electron"' >> debian/oopz-electron/usr/bin/oopz-electron
	echo 'cd "$$APP_DIR" || exit 1' >> debian/oopz-electron/usr/bin/oopz-electron
	echo '' >> debian/oopz-electron/usr/bin/oopz-electron
	echo '# 允许用户通过环境变量覆盖 Electron 可执行文件' >> debian/oopz-electron/usr/bin/oopz-electron
	echo 'if [ -n "$$ELECTRON_PATH" ] && [ -x "$$ELECTRON_PATH" ]; then' >> debian/oopz-electron/usr/bin/oopz-electron
	echo '  ELECTRON_BIN="$$ELECTRON_PATH"' >> debian/oopz-electron/usr/bin/oopz-electron
	echo 'elif command -v electron37 >/dev/null 2>&1; then' >> debian/oopz-electron/usr/bin/oopz-electron
	echo '  ELECTRON_BIN="$$(command -v electron37)"' >> debian/oopz-electron/usr/bin/oopz-electron
	echo 'elif command -v electron >/dev/null 2>&1; then' >> debian/oopz-electron/usr/bin/oopz-electron
	echo '  ELECTRON_BIN="$$(command -v electron)"' >> debian/oopz-electron/usr/bin/oopz-electron
	echo 'else' >> debian/oopz-electron/usr/bin/oopz-electron
	echo '  echo "Electron runtime not found. Please install electron or electron37." >&2' >> debian/oopz-electron/usr/bin/oopz-electron
	echo '  exit 127' >> debian/oopz-electron/usr/bin/oopz-electron
	echo 'fi' >> debian/oopz-electron/usr/bin/oopz-electron
	echo '' >> debian/oopz-electron/usr/bin/oopz-electron
	echo 'echo "[Tip] 首次加载资源可能需要 10s 左右"' >> debian/oopz-electron/usr/bin/oopz-electron
	echo 'exec "$$ELECTRON_BIN" main.js "$$@"' >> debian/oopz-electron/usr/bin/oopz-electron
	
	chmod +x debian/oopz-electron/usr/bin/oopz-electron

override_dh_auto_clean:
	# 清理构建文件
